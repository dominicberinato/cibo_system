{"version":3,"sources":["webpack:///./components/sections/PermComponent.jsx"],"names":["actions","props","auth","dispatch","undefined","child","uid","once","then","userShot","val","userFanOut","update","push","user","console","log","propCode","propShot","property","addProperty","propKey","key","lastPropertyKey","orderByValue","userprops","forEach","propUsersList","propUser","lastProperty","propSnapShot","welcomeMessage","uname","name","state","PermComponent"],"mappings":"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","file":"2.bundle.js","sourcesContent":["import React,{Component} from 'react'\nimport {connect} from 'react-redux'\nimport firebase,{firebaseRef} from 'src/firebase/index'\nimport {hashHistory} from 'react-router'\nimport * as actions from 'src/actions/actions'\n\nexport class PermComponent extends Component {\n  constructor(props) {\n    super(props)\n  }\n  componentDidMount() {\n    var {auth, dispatch} = this.props;\n    if(auth != undefined)\n    {\n      //check that user doesnt exist\n      firebaseRef.child(`users/${auth.uid}`).once('value').then((userShot) => {\n        if(userShot.val() == null) {\n          var userFanOut = {}\n          userFanOut[`/users/${auth.uid}`] = auth;\n          return firebaseRef.update(userFanOut).then(() => {\n            hashHistory.push('/app');\n          })\n        }\n        else {\n          //check if user is admin and accord more perms\n          //select user\n          firebaseRef.child(`users/${auth.uid}`).once('value').then((userShot) => {\n            //check if user has a propCode\n            var user = userShot.val();\n            console.log('this is the user', user);\n            if(user.propCode) {\n              //user has prop code download property and send to admin\n              //download a the property\n              firebaseRef.child(`properties/${user.propCode}`).once('value').then((propShot) => {\n                var property = propShot.val();\n                dispatch(actions.addProperty({\n                  ...property,\n                  propKey: propShot.key\n                }));\n                hashHistory.push('/app');\n              })\n            } else {\n              //TODO create user property list\n              var lastPropertyKey;\n              firebaseRef.child('property-users').orderByValue()\n              .once('value', (userprops) => {\n                userprops.forEach((propUsersList) => {\n                  propUsersList.forEach((propUser) => {\n                    var lastProperty = propUsersList.key;\n                  })\n                })\n              })\n\n              //dispatch prop action\n              //collect this property from db\n              firebaseRef.child(`properties/${propUsersList.key}`).once('value').then((propSnapShot) => {\n                dispatch(actions.addProperty({\n                  ...propSnapShot.val(),\n                  propKey: propUsersList.key\n                }));\n                hashHistory.push('/app')\n              })\n            }\n          })\n\n        }\n      })\n    }\n  }\n  render() {\n    //get user object from state\n    var {auth, dispatch} = this.props;\n    var welcomeMessage = () => {\n      if(auth != undefined) {\n        var uname = auth.name;\n        return(\n          <div className=\"text-center permissions-text>\">\n            <p>{`Hello ${uname}!`}</p>\n            <p>Please wait as we load your property</p>\n          </div>\n        )\n      }\n    }\n    return(\n      <div>\n      {welcomeMessage()}\n    </div>)\n  }\n}\nexport default connect((state) => {\n  return {\n    auth: state.auth\n  }\n})(PermComponent);\n\n\n\n// WEBPACK FOOTER //\n// ./components/sections/PermComponent.jsx"],"sourceRoot":""}